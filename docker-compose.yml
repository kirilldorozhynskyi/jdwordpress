version: '3.8'
services:
  # mariadb - database
  mariadb:
    container_name: ${APP_NAME:-develop}.mariadb
    image: mariadb:latest
    volumes:
      - ./_db:/var/lib/mysql
      - ./dockerconfig/php.ini:/usr/local/etc/php/conf.d/uploads.ini
    environment:
      MYSQL_ROOT_PASSWORD: ${DB_PASSWORD:-develop}
      MYSQL_DATABASE: ${APP_NAME:-develop}
    ports:
      - '${DB_PORT:-3306}:3306'

  # PhpMyAdmin - mysql
  phpmyadmin:
    container_name: ${APP_NAME:-develop}.phpmyadmin
    image: phpmyadmin/phpmyadmin:latest
    restart: always
    environment:
      PMA_HOST: ${APP_NAME:-develop}.mariadb
      PMA_USER: ${DB_USER:-root}
      PMA_PASSWORD: ${DB_PASSWORD:-dev}
    ports:
      - '${PHPMYADMIN_PORT:-8084}:80'
    depends_on:
      - mariadb

  # apache - server
  php:
    image: webdevops/php-apache:8.0
    container_name: ${APP_NAME:-develop}.php
    expose:
      - '${BACKEND_PORT:-3080}'
    ports:
      - '${BACKEND_PORT:-3080}:80'
    volumes:
      - './:/app'
      - './dockerconfig/php.ini:/usr/local/etc/php/conf.d/uploads.ini'
      - '/_db'
    environment:
      WEB_DOCUMENT_ROOT: /app/web
    restart: always
    depends_on:
      - mariadb
